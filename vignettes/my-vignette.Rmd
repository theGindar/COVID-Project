---
title: "COVID-Project"
author: "Patrick Günther, David Scheid, Feisal Ahmad"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{COVID-Project}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
Das COVID-Project ist ein Package, welches dem Nutzer aktuelle Daten des Robert-Koch-Instituts zur Coronapandemie zur Verfügung stellt. Die Datentabelle wird anhand der Anforderungen des Nutzers neu gefiltert und Daten werden aggregiert, um dem Nutzer spezifische Fragen zu den Coronazahlen zu beantworten. Zudem können die Daten in verschiedensten Plots dargestellt werden.

# Setup

Führe den untenstehenden Befehl aus, um das Package zu laden.
```{r setup}
library(covidproject)
```
Zudem muss zu Beginn einmal die Datentabelle des Robert-Koch-Instituts heruntergeladen werden:

```{r load_covid_data}
dir_path <- system.file("extdata/weather_data", package="covidproject")
data_downloader(dir_path)
cov_data <- read.csv(paste0(dir_path, "/data.csv"))
```

# Filter functions

Die *filter functions* dienen dazu, die umfangreiche Datentabelle des Robert-Koch-Instituts, welche alle Fälle seit Beginn der Pandemie führt, zu filtern und Daten zu aggregieren. 

## get-Methoden

Jede *get_...-Methode* gibt eine neue Datentabelle zurück, die dem Nutzer genau die gewünschte Information aufzeigt. 
Folgende Eingabeparameter kann der Nutzer variieren:

+ *age_group_start*: Ab welchem Alter will man Ergebnisse sehen
+ *age_group_end*: Bis zu welchem Alter will man Ergebnisse sehen
+ *date_start*: Ab welchem Datum will man Ergebnisse sehen
+ *date_end*: Bis zu welchem Datum will man Ergebnisse sehen
+ *federal_state* oder *district*: Je nach Methode, welche Bundesländer bzw. Landkreise will man sehen

Mit der Methode *get_deaths_per_federal_state* kann man sich zum Beispiel Todeszahlen zu einzelnen Bundesländern anzeigen lassen.
```{r get_deaths_per_federal_state}
deaths_bayern_hessen <- get_deaths_per_federal_state(cov_data, date_start = "2020/06/01", date_end = "2020/12/01", federal_state = c("Bayern", "Hessen"))
```
Hier wird eine Tabelle mit der Anzahl von Todesfällen in Bayern und Hessen im Zeitraum vom 1. Juni 2020 bis 1. Dezember 2020 ausgegeben. Es werden hierbei alle Altersgruppen betrachtet, da diese nicht mittels der Parameter eingeschränkt wurden.
Weitere Beispiele gibt es mit der Funktion *covidproject::examples*.

## Inzidenz

Mit der Methode *get_incidence_per_district* kann man sich die Inzidenz für bestimmte Landkreise anzeigen lassen. Die Inzidenz gibt an, wie viele Neuinfektionen pro 100.000 Einwohner in einer gewissen Zeitspanne gab. In der Regel liegt diese bei 7 Tagen, man kann sie aber mithilfe vom Parameter *incidence_days* variieren.
```{r incidence}
incidence_flensburg_kiel <- get_incidence_per_district(cov_data, district = c("SK Flensburg", "SK Kiel"))
```

## Unclean Data

Teilweise gibt es in der Datentabelle Daten, die fehlerhaft oder unvollständig sind und die mit diesen Funktionen entfernt werden können.
Hierzu zählen:

+ Der Fall war nur in der Publikation des Vortages enthalten
+ Der Fall ist jetzt kein Todesfall mehr, obwohl er es in vorigen Publikationen war
+ Der Fall ist jetzt nicht mehr genesen, obwohl er es in vorigen Publikationen war
+ Die Altersgruppe des Falls ist unbekannt

```{r unclean_data}
unclean_data <- get_unclean_data(cov_data)
remove_unclean_data(unclean_data)
```


# Plot functions

Die *plot functions* dienen dazu die neu generierten Datentabellen grafisch darzustellen. Hierbei muss der Nutzer keine weiteren Parameter angeben. Die Funktion findet automatisch zu jeder Tabelle den passenden Plot.

```{r plot_functions}
covidproject::plotfunctions
```

Um die Beispieltabelle von oben zu plotten, kann ganz einfach folgender Befehl ausgeführt werden:

```{r plot_deaths}
plot_function(deaths_bayern_hessen)
```

# Forecasting

Mit der Funktion *predict_future_progress* wird versucht eine zukünftige Prognose für Coronazahlen zu geben. Mithilfe einer Zeitreihe aus den Daten und einem Prophet-Model, werden Daten prognostiziert. Mit dem Parameter *future_days* lässt sich angeben, wie viele Tage man in die Zukunft sehen möchte.

```{r predict_future_progress}
covidproject::forecasting
predict_future_progress(cov_data, future_days = 50)
```

# Fragestellungen

## Erkrankungsdatum

Um zu vergleichen für wie viele Fälle das Erkrankungsdatum bekannt ist, kann man sich mit der Methode *get_infections_overall* die Summe dieser Fälle ausgeben lassen. Hierfür ist in der Datentabelle des Robert-Koch-Instituts eine Zeile verfügbar, die genau diesen Sachverhalt bestimmen lässt. Um die Zahl mit der Gesamtzahl zu vergleichen nutzt man die bereits bekannten *get_infections_...-Methoden

## Vergleich von Landkreisen

Mit der Methode *get_correlation_for_incidence_pairs* lässt sich die Korrelation der Inzidenzen zwischen zwei Landkreisen berechnen. Man kann schauen wie sehr die einzelnen Inzidenzen von verschiedenen Landkreisen im Zusammenhang stehen.

```{r correlations}
incidences <- get_incidence_per_district(cov_data)
correlations <- get_correlation_for_incidence_pairs(incidences)
plot_incidence_correlations_matrix(correlations)
plot_incidence_correlations_barchart(correlations)
```

## Fallsterblichkeit

Die Fallsterblichkeit gibt den Anteil an Todesfällen pro entdecktem Infektionsfall an. An der Fallsterblichkeit lässt sich erkennen wie todesgefährlich eine Krankheit ist. Mit der Funktion *get_fallsterblichkeit_overall* lässt sich ein Dataframe erstellen, welches den Verlauf der Fallsterblichkeit über den gesamten Coronazeitraum darstellt. Hierbei ist es möglich mithilfe von Parametern die Altersgruppen einzuschränken.

```{r fallsterblichkeit}
fallsterblichkeit <- get_fallsterblichkeit_overall(cov_data)
plot_function(fallsterblichkeit)
```

## Wetter

Oft wird behauptet, die Coronazahlen hängen stark mit dem Wetter zusammen. Es wird davon ausgegangen, das Virus verbreite sich schlechter bei warmem Wetter. Mithilfe des Parameters *add_weather* in der *plot_function* kann ma sich die zugehörige Durchschnittstemperatur für den bestimmten Zeitraum einzeichnen lassen. So kann untersucht werden, ob das Wetter Einfluss auf die Coronazahlen hat.

```{r weather}
infections_bayern_hessen <- get_infections_per_federal_state(cov_data, date_start = "2020/06/01", date_end = "2020/12/01", federal_state = c("Bayern", "Hessen"))
plot_function(infections_bayern_hessen)
```
